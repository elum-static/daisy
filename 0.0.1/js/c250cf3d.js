var t=Object.defineProperty,e=(e,i,s)=>(((e,i,s)=>{i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s})(e,"symbol"!=typeof i?i+"":i,s),s);import{r as i,j as s,a as h,c as n}from"./f0e14017.js";import{c as r,C as a}from"./0d094167.js";class o{constructor(){e(this,"ratio",[0,0]),e(this,"width",0),e(this,"height",0),e(this,"unitSize",0),e(this,"partsX",[]),e(this,"partsY",[]),e(this,"update",((t,e,i)=>{if(this.height===i&&this.width===e)return;this.height=i,this.width=e,this.ratio=t;const[s,h]=this.ratio,n=this.height/h;if(n*s>this.width){const t=this.width/s,e=h*t,i=e/h,n=(this.height-e)/2;this.partsX=[],this.partsY=[];for(let h=0;h<s;h++)this.partsX[h]=h*t+t/2;for(let s=0;s<h;s++)this.partsY[s]=s*i+n+t/2;return void(this.unitSize=t)}const r=s*n,a=r/s,o=(this.width-r)/2;for(let c=0;c<s;c++)this.partsX[c]=c*a+o+a/2;for(let c=0;c<h;c++)this.partsY[c]=c*n+a/2;this.unitSize=a})),e(this,"getMeter",(t=>this.meter*t)),e(this,"getY",(t=>this.partsY[t-1]??0)),e(this,"getX",(t=>this.partsX[t-1]??0)),e(this,"getCordinate",((t,e)=>[this.getX(t),this.getY(e)])),e(this,"isCollision",((t,e)=>!(t.x+t.width<e.x||t.x>e.x+e.width||t.y+t.height<e.y||t.y>e.y+e.height))),e(this,"random",((t,e)=>{let i=t-.5+Math.random()*(e-t+1);return Math.round(i)})),e(this,"mutexSet",new Set),e(this,"mutex",((t,e)=>{const i=t.unique,s=e.unique;return!this.mutexSet.has(i+s)&&!this.mutexSet.has(s+i)&&(this.mutexSet.add(i+s),!0)}))}get clampX(){return[this.partsX[0],this.partsX[this.partsX.length-1]+this.meter]}get clampY(){return[this.partsY[0],this.partsY[this.partsY.length-1]+this.meter]}get meter(){return this.unitSize||0}}let c;class l{constructor(t,i,s,h){e(this,"unique"),e(this,"x"),e(this,"y"),e(this,"width"),e(this,"height"),this.x=t,this.y=i,this.width=s,this.height=h,this.unique=function(t){const e="abdehkmnpswxzABDEFGHKMNPQRSTWXZ123456789";for(var i="",s=0;s<t;s++){var h=Math.floor(40*Math.random());i+=e.substring(h,h+1)}return i}(32)}}var d=(t=>(t.EMPTY="empty",t.DANGER="danger",t.HEART="heart",t.BLUE="blue",t.RED="red",t.WHITE="white",t.YELLOW="yellow",t))(d||{});class u extends l{constructor(t,i,s){super(0,0,0,0),e(this,"type"),e(this,"startTimer"),e(this,"position"),e(this,"draw"),e(this,"render",((t,e)=>{this.startTimer||(this.startTimer=Date.now());const i=1e3-t.game.gravity||100;this.width=e.getMeter(1),this.height=e.getMeter(1);const s=this.width/2,[h,n]=e.clampY,a=(n-h)/e.meter,o=Date.now()-this.startTimer;this.x=e.getX(this.position)-s,this.y=e.getY(1)+e.getMeter(r(o/i,0,a))-s,this.draw&&this.draw()})),this.type=t,this.position=i,this.draw=s}}class g extends l{constructor(){super(0,0,0,0),e(this,"render",((t,e,i)=>{this.width=i.getMeter(2),this.height=i.getMeter(1);const s=this.width/2,[h,n]=i.clampX,a=i.getMeter(1)/2;this.x=r(e-s,h-a,n-this.width-a),this.y=i.getY(15)-a,t.fillStyle="black",t.fillRect(this.x,this.y,this.width,this.height)}))}}class m extends l{constructor(t,i,s,h,n){super(t,i,s,h),e(this,"execute"),e(this,"render",((t,e)=>{})),this.execute=()=>n(this)}}class y extends u{constructor(t,i){super(d.EMPTY,i.random(1,9),(()=>{})),e(this,"positive",(t=>{t.entity.units.delete(this)})),e(this,"negative",(t=>{t.entity.units.delete(this)}))}}class p extends u{constructor(t,i){super(d.EMPTY,i.random(1,9),(()=>{const e=this.width/2;t.beginPath(),t.arc(this.x+e,this.y+e,this.width/2,0,2*Math.PI,!1),t.fillStyle="red",t.fill()})),e(this,"positive",(t=>{t.entity.units.delete(this),t.game.heart-=1,0===t.game.heart&&(t.entity.units=new Set,t.game.heart=3,t.game.score=0)})),e(this,"negative",(t=>{t.entity.units.delete(this)}))}}class w extends u{constructor(t,i){super(d.EMPTY,i.random(1,9),(()=>{const e=this.width/2;t.beginPath(),t.arc(this.x+e,this.y+e,this.width/2,0,2*Math.PI,!1),t.fillStyle="#ed5d91",t.fill()})),e(this,"positive",(t=>{t.entity.units.delete(this),t.game.heart=r(t.game.heart+1,0,3),t.game.score+=1})),e(this,"negative",(t=>{t.entity.units.delete(this)}))}}class f extends u{constructor(t,i){super(d.EMPTY,i.random(1,9),(()=>{t.fillStyle="#0d5090",t.fillRect(this.x,this.y,this.width,this.height)})),e(this,"positive",(t=>{t.entity.units.delete(this),t.game.score+=1})),e(this,"negative",(t=>{t.entity.units.delete(this),t.game.heart-=1,0===t.game.heart&&(t.entity.units=new Set,t.game.heart=3,t.game.score=0)}))}}class x extends u{constructor(t,i){super(d.EMPTY,i.random(1,9),(()=>{t.fillStyle="#c2382c",t.fillRect(this.x,this.y,this.width,this.height)})),e(this,"positive",(t=>{t.entity.units.delete(this),t.game.score+=1})),e(this,"negative",(t=>{t.entity.units.delete(this),t.game.heart-=1,0===t.game.heart&&(t.entity.units=new Set,t.game.heart=3,t.game.score=0)}))}}class v extends u{constructor(t,i){super(d.EMPTY,i.random(1,9),(()=>{t.fillStyle="#adb6be",t.fillRect(this.x,this.y,this.width,this.height)})),e(this,"positive",(t=>{t.entity.units.delete(this),t.game.score+=1})),e(this,"negative",(t=>{t.entity.units.delete(this),t.game.heart-=1,0===t.game.heart&&(t.entity.units=new Set,t.game.heart=3,t.game.score=0)}))}}class E extends u{constructor(t,i){super(d.EMPTY,i.random(1,9),(()=>{t.fillStyle="#fae033",t.fillRect(this.x,this.y,this.width,this.height)})),e(this,"positive",(t=>{t.entity.units.delete(this),t.game.score+=1})),e(this,"negative",(t=>{t.entity.units.delete(this),t.game.heart-=1,0===t.game.heart&&(t.entity.units=new Set,t.game.heart=3,t.game.score=0)}))}}const M=window&&"ontouchstart"in window,T=()=>{const[[t,e],l]=i.useState([3,0]),u=i.useRef(new o).current,T=i.useRef({game:{platform:u.getY(3),gravity:0,score:0,heart:3},entity:{player:new g,units:new Set,blocks:new Set}}).current,Y=t=>{console.log("end")},S=t=>{console.log("end")};const R=M?{onTouchStart:t=>{const e=t.touches[0];e&&(T.game.platform=2*e.clientX)},onTouchMove:t=>{const e=t.touches[0];e&&(T.game.platform=2*e.clientX)},onTouchEnd:Y,onTouchCancel:Y}:{onMouseDown:t=>{},onMouseMove:t=>{console.log("move")},onMouseUp:S,onMouseLeave:S};return s("div",{className:"Florist",children:[s("div",{className:"Florist_counter",children:[h("div",{className:"Florist_hearts",children:Array.from(Array(3)).map(((e,i)=>h("div",{className:n("Florist_heart",{"Florist_heart--active":i<t})},i)))}),h("span",{children:"score"}),h("span",{children:e})]}),h(a,{quality:2,limitFrames:120,onRender:({width:t,height:e,quality:i,context:s,next:h})=>{l([T.game.heart,T.game.score]),s.clearRect(0,0,t,e),u.update([9,16],t,e);const n=((t,e,i,s)=>{if(c)return c;const h=document.createElement("canvas"),n=h.getContext("2d");if(!n)return;h.width=i,h.height=s;const r=s/e;if(r*t>i){const h=i/t,r=e*h,a=r/e,o=(s-r)/2;for(let e=0;e<=t;e++)n.moveTo(e*h,0+o),n.lineTo(e*h,s-o);for(let t=0;t<=e;t++)n.moveTo(0,t*a+o),n.lineTo(i,t*a+o);n.strokeStyle="#d9d9d9",n.stroke()}else{const h=t*r,a=h/t,o=(i-h)/2;for(let e=0;e<=t;e++)n.moveTo(e*a+o,0),n.lineTo(e*a+o,s);for(let t=0;t<=e;t++)n.moveTo(0+o,t*r),n.lineTo(i-o,t*r);n.strokeStyle="#d9d9d9",n.stroke()}return c=new Image(i,s),c.src=h.toDataURL("image/png"),c})(9,16,t,e);var a;n&&s.drawImage(n,0,0),T.game.gravity=(a=T.game.score,r(800+a/50*120,800,920)),T.entity.units.forEach((t=>{t.render(T,u),u.isCollision(T.entity.player,t)&&t.positive(T)})),T.entity.blocks.forEach((t=>{t.render(s,u),t.execute()})),T.entity.player.render(s,T.game.platform,u),h()},onInitial:({width:t,height:e,quality:i,context:s,next:h})=>{u.update([9,16],t,e),T.game.platform=u.getX(5),T.entity.blocks.add(new m(u.getX(1),u.getY(16),u.getMeter(9),u.getMeter(1),(t=>{T.entity.units.forEach((e=>{u.isCollision(t,e)&&u.mutex(t,e)&&e.negative(T)}))}))),T.entity.blocks.add(new m(u.getX(1),u.getY(5),u.getMeter(9),u.getMeter(13),(t=>{T.entity.units.forEach((e=>{if(u.isCollision(t,e)&&u.mutex(t,e)){const t=function(t){const e=t.reduce(((t,[e,i])=>t+i),0),i=Math.random()*e;let s=0;for(const[h,n]of t)if(s+=n,i<s)return h;return d.EMPTY}([[d.EMPTY,5],[d.DANGER,4.8],[d.HEART,.2],[d.BLUE,5],[d.RED,15],[d.WHITE,30],[d.YELLOW,40]]);if(t===d.EMPTY){const t=new y(s,u);T.entity.units.add(t)}if(t===d.DANGER){const t=new p(s,u);T.entity.units.add(t)}if(t===d.HEART){const t=new w(s,u);T.entity.units.add(t)}if(t===d.BLUE){const t=new f(s,u);T.entity.units.add(t)}if(t===d.RED){const t=new x(s,u);T.entity.units.add(t)}if(t===d.WHITE){const t=new v(s,u);T.entity.units.add(t)}if(t===d.YELLOW){const t=new E(s,u);T.entity.units.add(t)}}}))}))),T.entity.units.add(new w(s,u)),h()},...R})]})};export{T as default};
